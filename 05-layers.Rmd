# Layers {#layers}

<!-- make the order of the table to be consistent with the rest of the chapter! -->

```{r, echo=FALSE}
layers_basic_df = tibble::tribble(
  ~Function, ~Element, ~Geometry,
  "tm_polygons()", "polygons (borders and fill)", "polygons",
  "tm_symbols()", "symbols", "points, polygons, and lines", 
  "tm_lines()", "lines", "lines", 
  "tm_raster()", "raster", "raster",
  "tm_text()", "text", "points, polygons, and lines",
  "tm_basemap()", "tile" , "",
  "tm_tiles()", "tile", ""
)
layers_extended_df = tibble::tribble(
  ~Function, ~Element, ~Geometry,
  "tm_borders()", "polygons (borders)", "polygons",
  "tm_fill()", "polygons (fill)", "polygons",
  "tm_bubbles()", "bubbles", "points, polygons, and lines",
  "tm_dots()", "dots", "points, polygons, and lines",
  "tm_markers()", "marker symbols", "points, polygons, and lines",
  "tm_square()", "squares", "points, polygons, and lines",
  "tm_iso()", "lines with text labels", "lines",
  "tm_rgb()/tm_rgba()", "raster (RGB image)", "raster"
)
layers_df = rbind(layers_basic_df, 
                  layers_extended_df)
```

\@ref(tab:layers-table)

```{r layers-table, echo=FALSE, warning=FALSE}
library(magrittr)
library(kableExtra)
options(kableExtra.html.bsTable = TRUE)
knitr::kable(layers_df, 
             caption = "Map layers.",
             caption.short = "Map layers.",
             booktabs = TRUE) %>%
  kableExtra::kable_styling("striped",
                            latex_options = "striped", 
                            full_width = FALSE) %>% 
  kableExtra::column_spec(1, bold = TRUE, monospace = TRUE) %>% 
  kableExtra::pack_rows("Basic functions", 1, 7) %>%
  kableExtra::pack_rows("Derived functions", 8, 15)
```

<!--JN: Idea - also add a simple viz showing different kind of layers here (visual summary)-->

In this chapter, we focus on what map layers are available in **tmap** and how they differ.
Chapter \@ref(visual-variables), on the other hand, is all about how to present information given in variables using colors, sizes, and shapes.
<!-- ... -->

## Polygons

<!-- intro -->

```{r, warning=FALSE, message=FALSE}
# replace this data with some new tmap dataset
library(tmap)
library(sf)
file_path = system.file("shapes/world.gpkg", package = "spData")
x = read_sf(file_path)
x = st_transform(x, 8857)
```

The main function to visualize polygons is `tm_polygons()`.
By default, it plots areas of polygons in light gray (`gray85`) and polygons borders in slightly dark gray (`gray40`).
<!--JN: where can I find the actual default color values in the code?-->

```{r, eval=FALSE}
tm_shape(x) +
  tm_polygons()
```

Both, colors of areas (polygons' fillings) and colors of borders can be modified using the `col` and `border.col` arguments (Figure \@ref(fig:tmpolygonsder):A).

```{r, eval=FALSE}
tm_shape(x) +
  tm_polygons(col = "lightblue", 
              border.col = "black", lwd = 0.5, lty = "dashed")
```

In fact, `tm_polygons()` is a combination of two separate functions - `tm_fill()` and `tm_borders()`.
The `tm_fill()` function fills polygons with a fixed color or a color palette representing a selected variable (Figure \@ref(fig:tmpolygonsder):B).

```{r, eval=FALSE}
tm_shape(x) +
  tm_fill(col = "lightblue")
```

The `tm_borders()` function draws the borders of the polygons only (Figure \@ref(fig:tmpolygonsder):C).
It allows to change the colors of borders, their widths, or the lines type.

```{r, eval=FALSE}
tm_shape(x) +
  tm_borders(col = "black", lwd = 0.5, lty = "dashed")
```

Notice that we have used the `col` argument in `tm_borders()`, but `border.col` in `tm_polygons()`.
This is necessary to distinguish between the setting of the fillings color and the borders' color.

```{r tmpolygonsder, warning=FALSE, fig.cap="Example of a map created with: (A) 'tm_polygons()' ,  (B) 'tm_fill()' , (C) 'tm_borders()' .", echo=FALSE}
tmpa0 = tm_shape(x) +
  tm_polygons(col = "lightblue", 
              border.col = "black", lwd = 0.5, lty = "dashed") +
  tm_layout(title = "A")
tmpa1 = tm_shape(x) +
  tm_fill(col = "lightblue") +
  tm_layout(title = "B")
tmpa2 = tm_shape(x) +
  tm_borders(col = "black", lwd = 0.5, lty = "dashed") +
  tm_layout(title = "C")
tmap_arrange(tmpa0, tmpa1, tmpa2, ncol = 1)
```

More information on colors, and how they can be applied and modified is explained in detail in Chapter \@ref(colors).

## Symbols

```{r}
data("metro", package = "tmap")
# to update later
set.seed(222)
metro2 = metro[sample(1:nrow(metro), 30), ]
```

```{r}
tm_shape(metro2) +
  tm_symbols()
```

<!--explain size, col, shape + ref to a section in the next chapter-->

<!--add info that there are four additional (shortcut) layers-->
<!--explain each additional layer underlining the differences between tm_symbols() and the rest--> 

```{r}
tm_shape(metro2) +
  tm_squares()
```

```{r}
tm_shape(metro2) +
  tm_bubbles()
```

```{r}
tm_shape(metro2) +
  tm_dots()
```

```{r}
tm_shape(metro2) +
  tm_markers()
```

## Lines

```{r}
# replace dataset later
library(tmap)
data("rivers", package = "tmap")
```

```{r}
tm_shape(rivers) + 
  tm_lines()
```

<!-- think about tm_iso example -->

## Text

```{r}
tm_shape(metro2) +
  tm_text(text = "name", size = "pop2020") +
  tm_layout(legend.outside = TRUE)
```

## Raster

```{r}
data(land, package = "tmap")
```

```{r}
tm_shape(land[3]) +
  tm_raster()
```

```{r}
tm_shape(land) +
  tm_raster()
```

## Tile

## Combining layers

<!-- or maybe start with it and explain the details later? -->